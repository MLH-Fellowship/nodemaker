# Nodemaker

Proof of concept for n8n node generator.

Autogenerate node files and place them in the n8n repos!

**Features**:

- File generation
  - Node functionality files
    - `*.node.ts`
    - `GenericFunctions.ts`
    - `*Description.ts` (optional)
    - `*.credentials.ts`
    - `package.json`
  - Node documentation files
    - `README.md` (node)
    - `README.md` (credential)
    - In-app screenshot of node
  - Five icon candidates
- Resizing of selected icon candidate
- Placement of generated files in repos
  - Node functionality files in `n8n` repo
  - Node documentation files in `n8n-docs` repo

[Roadmap for next steps](https://github.com/ivov/nodemaker/issues/1)

## Installation

1. Clone repo.
2. Install dependencies: `npm i`

## Operation

1. Enter node params in `parameters.js`. More info on editing params below.
2. Run one of the following scripts:

```
$ npm run [script]
```

| Script    | Action                                                                                             |
| --------- | -------------------------------------------------------------------------------------------------- |
| `nodegen` | Generate `*.node.ts`, `GenericFunctions.ts`, `*Description.ts` (optional), and `*.credentials.ts`. |
| `packgen` | Generate a `package.json` updated with node path and credential path insertions.                   |
| `docsgen` | Generate a node functionality doc file and a node credential doc file in markdown.                 |
| `shotgen` | Generate an in-app screenshot of the node for the docs. For **pre-requisite**, see below.          |
| `icongen` | Generate five images as icon candidates. For **pre-requisite**, see below.                         |
| `resize`  | Resize one of the generated icon candidates to a 60×60 px PNG file.                                |
| `place`   | Move files at `/output` to the `n8n` and `n8n-docs` repos. For **pre-requisite**, see below.       |
| `empty`   | Clear the `/output` dir                                                                            |

### Notes

- All output files are generated at `nodemaker/output` dir.
- Generated files may contain `// TODO:` lines, for adding in custom logic.
- `nodegen` prompts for node generation type. In **simple node generation**, the output node has its resources in a single file. In **complex node generation**, the output node has its resources in separate `*Description.ts` files.
- `nodegen` generates no credential file if `metaParameters.authType` is `"None"`.
- `packgen` retrieves the `package.json` at runtime from the official repo.

### Pre-requisites

- `shotgen` [requires credentials](#screenshot-generation-credentials) for image hosting.
- `icongen` [requires credentials](#icon-generation-credentials) for image search.
- `place` requires `nodemaker` to sit alongside the `n8n` and `n8n-docs` repos.

```bash
.
├── n8n
├── n8n-docs
└── nodemaker
```

## Editing params

Node params are divided into:

- `metaParameters` (service-related)
- `mainParameters` (resource-related)

Types for both sets of parameters are defined in `globals.d.ts`. Wrong parameters trigger TypeScript type error messages.

### `metaParameters`

```js
const metaParameters = {
  serviceName: "Some Service", // casing and spacing as in original service
  auth: "OAuth2",
  nodeColor: "#ff6600",
  apiUrl: "http://api.service.com/",
};
```

### `mainParameters`

`mainParameters` is a big object containing resource names as properties pointing to arrays of operations.

Operations all have the same five fields `name`, `description`, `endpoint`, `requestMethod` and `fields`. `endpoint` can contain a variable between double dollar signs, as in `endpoint: "items/$$articleId$$"`, to allow for the endpoint to be fully autogenerated.

The operation's `fields` property points to an array of objects, which may be:

- **Regular fields**, which contain the properties `name`, `description`, `type`, and `default`, or
- **Group fields**, which contain the properties `name`, `description`, `type: collection` or `type: multiOptions`, `default: {}`, and `options`.

Group fields with `name: "Additional Fields"` should be used for optional fields, i.e. those not needed for the request to succeed.

The `options` property points to an array of objects structured like a regular or group field. Two-level nesting is supported. When using `multiOptions`, `options` should point to an object containing only `name` and `description`.

```js
const mainParameters = {
  Resource1: [
    // first operation for first resource
    {
      name: "Get",
      description: "Get some entity",
      endpoint: "entity/$$entityId$$",
      requestMethod: "GET",
      fields: [
        {
          name: "Entity ID",
          description: "The ID of entity to be returned",
          type: "string",
          default: "",
        },
        {
          name: "Additional Fields",
          type: "collection",
          default: {},
          options: [
            {
              name: "Keyword",
              description: "The keyword for filtering the results of the query",
              type: "string",
              default: "",
            },
          ],
        },
      ],
    },
    // second operation for first resource
    {
      name: "Put",
      // etc.
    },
  ],
  Resource2: [
    // etc.
  ],
};
```

Field display restrictions are inferred from the object structure, but if you have an additional field display restriction, you can add it with `extraDisplayRestriction: { fieldName: boolean }`.

## Screenshot generation credentials

The generated screenshot is hosted at Imgbb, which requires an API Key, to be placed in a `.env` file in `/config`, containing:

```bash
IMGBB_API_KEY="6d17c6..."
```

To generate your own Imgbb API Key:

1. Visit [Imgbb](https://imgbb.com/).
2. Create an account or sign in with one of the services offered.
3. While logged in, visit the [Imgbb API docs](https://api.imgbb.com/).
4. Click on `Get API key` and use it for `IMGBB_API_KEY` in the `.env` file.

## Icon generation credentials

Icon candidate generation uses Google's Custom Search Engine, which requires credentials. Please note that Google's Custom Search Engine is limited to 100 free requests a day. Credentials are to be placed in a `.env` file in `/config`, containing:

```bash
GOOGLE_IMAGE_SEARCH_ENGINE_ID="01782..."
GOOGLE_PROJECT_API_KEY="AIzaS..."
```

Please contact the author for a Search Engine ID and API Key, or generate your own as described below.

**Configuring Custom Search Engine and generating an engine ID**

1. Access the [Custom Search Engine dashboard](https://cse.google.com/cse/create/new).
2. Enter any site in `Sites to Search`, name the engine and `Create`.
3. Click on `Edit search engine` and then on `Setup`.
4. Under `Basics`, copy the string `Search engine ID` and use it for `GOOGLE_IMAGE_SEARCH_ENGINE_ID` in the `.env` file.
5. Under `Basics`, switch on `Image search`.
6. Under `Basics`, switch on `Search the entire web`.
7. Under `Basics`, in `Sites to search`, delete the site you added in step 2.

**Configuring a Google Cloud Platform project and generating an API key**

1. Access the [Google Cloud Platform dashboard](https://console.developers.google.com).
2. On the top-left corner, click on the project name and then on `New Project`.
3. Name the project and `Create`.
4. Select your new project on the top-left corner.
5. Click on `Enable APIs and Services`, search for `Custom Search API`, select it and enable it.
6. Click on `Create Credentials` on the top-right corner, then on `Credentials` on the left nav, then on the `API key` hyperlink, and finally on `Create`. Use the generated API key for `GOOGLE_PROJECT_API_KEY` in the `.env` file.
