# Nodemaker

Quick proof of concept for n8n node generator.

## Installation

1. Clone repo
2. Install dependencies: `npm i`

## Operation

Run it with `npm run start`. A functional example file is already provided in `parameters.js`. Edit the params to generate a custom node. More info on editing params below.

Files are generated in `/output`:
- `Entity.node.ts`
- `EntityCredentialTypeApi.credentials.ts`
- `GenericFunctions.ts`
- `package.json`

> The credentials file is not generated if the `auth` property in `metaParameters` is an empty string.

The three TypeScript files contain `// TODO:` lines, for the developer to add in custom logic.

`package.json` is the one at `/packages/nodes-base/package.json`. The paths for the node and credentials are inserted at the right spot in alphabetic order. The pre-insertion `package.json` is retrieved at runtime from the official repo.

Regenerating files overwrites same-name files. You can clean up the `/output` dir with `npm run empty`.

## Editing params

Node params are divided into:
- `metaParameters` (non-resource-related params), and
- `mainParameters` (resource-related).

### `metaParameters`

```js
const metaParameters = {
  serviceName: "Some Service",      // casing and spacing as in original service
  auth: "OAuth2",                   // "OAuth2" or "Key" or ""
  nodeColor: "#ff6600",
  apiUrl: "http://api.service.com/",
};
```

### `mainParameters`

`mainParameters` is a big object containing resource names as properties pointing to arrays of operations.

Operations all have the same five fields `name`, `description`, `endpoint`, `requestMethod` and `fields`. `endpoint` can contain a variable between double dollar signs, as in `endpoint: "items/$$articleId$$"`, to allow for the endpoint to be fully autogenerated.

The operation's `fields` property points to an array of objects, which may be:

- **Regular fields**, which contain the properties `name`, `description`, `type`, and `default`, or
- **Group fields**, which contain the properties `name`, `description`, `type: collection` or `type: multiOptions`, `default: {}`, and `options`.

Group fields with `name: "Additional Fields"` should be used for optional fields, i.e. those not needed for the request to succeed.

The `options` property points to an array of objects structured like a regular or group field. Two-level nesting is supported. When using `multiOptions`, `options` should point to an object containing only `name` and `description`.

```js
const mainParameters = {
    Entity1: [
        // first operation for Entity1 (some resource)
        {
            name: "Get",
            description: "Get some entity",
            endpoint: "entity/$$entityId$$",
            requestMethod: "GET",
            fields: [
                {
                    name: "Entity ID",
                    description: "The ID of entity to be returned",
                    type: "string",
                    default: "",
                },
                {
                    name: "Additional Fields",
                    type: "collection",
                    default: {},
                    options: [
                        {
                            name: "Keyword",
                            description: "The keyword for filtering the results of the query",
                            type: "string",
                            default: "",
                        },
                    ],
                },
            ],
        },
        // second operation for Entity1 (same resource as above)
        {
            name: "Put",
            // etc.
        }
    ],
    Entity2: [
        // etc.
    ],
}
```

Field display restrictions are inferred from the object structure, but if you have an additional field display restriction, you can add it with `extraDisplayRestriction: { fieldName: boolean }`.
